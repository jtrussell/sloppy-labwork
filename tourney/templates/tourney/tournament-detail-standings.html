{% extends "tourney/tournament-detail-base.html" %}

{% block tab_content %}
<div id="tournament-content">
    {% if not user.is_authenticated %}
        <section>
            <p class="text-muted" style="text-align: center; font-style: italic;">
                Please log in to view tournament standings and player details.
            </p>
        </section>
    {% else %}
        <section>
            {% if standings %}
                <h2>Tournament Standings</h2>
                <div style="overflow-x: auto">
                    <table class="standings-table">
                        <thead>
                            <tr>
                                <th style="max-width: 35px; text-align: center;">#</th>
                                <th>Player</th>
                                <th>W-L (B)</th>
                                {% for criterion in enabled_criteria %}
                                    <th>
                                        <span class="text-muted">{{ forloop.counter }}.</span>
                                        {{ criterion.get_name }}
                                    </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for standing in standings %}
                            <tr{% if standing.is_dropped %} class="text-muted"{% endif %}>
                                <td style="text-align:center" class="text-muted"><strong>{{ standing.tournament_rank }}</strong></td>
                                <td>
                                    {{ standing.player.get_display_name }}
                                    {% if standing.is_dropped %}
                                        <span class="text-muted">(Dropped)</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if standing.is_in_current_stage %}
                                        {{ standing.wins | default:0 }} - {{ standing.losses | default:0 }}
                                        {% if standing.byes is not None and standing.byes > 0 %}
                                            ({{ standing.byes }})
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                {% for criterion in enabled_criteria %}
                                    <td>
                                        {% with key=criterion.get_key %}
                                            {% if not standing.is_in_current_stage %}
                                                <span class="text-muted">-</span>
                                            {% elif key == 'points' %}
                                                {% if standing.points is not None %}{{ standing.points }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'wins' %}
                                                {% if standing.wins is not None %}{{ standing.wins }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'losses' %}
                                                {% if standing.losses is not None %}{{ standing.losses }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'strength_of_schedule' %}
                                                {% if standing.strength_of_schedule is not None %}{{ standing.strength_of_schedule|floatformat:2 }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'seed' %}
                                                {% if standing.seed is not None %}{{ standing.seed }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'head_to_head' %}
                                                {% if standing.head_to_head_value is not None %}{{ standing.head_to_head_value }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'random' %}
                                                {% if standing.is_in_current_stage %}<span class="text-muted">üïµÔ∏è</span>{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'player_score' %}
                                                {% if standing.player_score_value is not None %}{{ standing.player_score_value }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'opponent_score' %}
                                                {% if standing.opponent_score_value is not None %}{{ standing.opponent_score_value }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% elif key == 'score_differential' %}
                                                {% if standing.score_differential_value is not None %}{{ standing.score_differential_value }}{% else %}<span class="text-muted">-</span>{% endif %}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        {% endwith %}
                                    </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted">No standings available yet. Tournament needs to begin.</p>
            {% endif %}
        </section>
    {% endif %}

    {% include 'tourney/partials/tournament-control.html' %}
</div>
{% endblock %}