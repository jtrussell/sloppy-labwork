{% extends 'page.html' %}
{% load static %}
{% load posts_extras %}

{% block head_title %}{{ lineup.name }} - Sloppy Labwork{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'lineups/main.css' %}">
{% endblock %}

{% block content %}
<nav class="breadcrumb">
  <a href="{% url 'lineups-list' %}">Lineups</a> &raquo;
  {{ lineup.name }}
</nav>

<h1>{{ lineup.name }}</h1>
<ul class="subheading inline-list">
  {% if lineup.format %}<li>{{ lineup.format.name }}</li>{% endif %}
  <li>{{ lineup.get_visibility_display }}</li>
</ul>

{% if is_owner %}
<ul class="subheading inline-list">
  <li><a href="{% url 'lineups-edit' lineup.code %}" class="button button-link button-link-bordered">Edit</a></li>
  <li>
    <form method="post" action="{% url 'lineups-delete' lineup.code %}" class="form-inline">
      {% csrf_token %}
      <button type="submit" class="button button-link button-link-bordered" hx-post="{% url 'lineups-delete' lineup.code %}" hx-confirm="Are you sure you want to delete this lineup?">Delete</button>
    </form>
  </li>
</ul>
{% endif %}

{% if lineup.description %}
<div class="lineup-description">
  {{ lineup.description|markdown|safe }}
</div>
{% endif %}

<h2>Versions</h2>
{% if is_owner %}
<ul class="subheading inline-list">
  <li><a href="{% url 'lineups-version-create' lineup.code %}" class="button button-link button-link-bordered">Add Version</a></li>
</ul>
{% endif %}

{% if versions %}
<div class="version-list">
  {% for version in versions %}
  <div class="version-card">
    <h3 class="version-card__title"><a href="{% url 'lineups-version-detail' version.code %}">{{ version.name }}</a></h3>
    <ul class="version-card__meta inline-list">
      <li>{{ version.version_decks.count }} Deck{{ version.version_decks.count|pluralize }}</li>
      <li>{{ version.notes.count }} Note{{ version.notes.count|pluralize }}</li>
      <li>{{ version.get_effective_visibility|capfirst }}</li>
    </ul>
  </div>
  {% endfor %}
</div>

{% if versions.paginator.num_pages > 1 %}
<div class="pagination">
  {% if versions.has_previous %}
  <a href="?vp={{ versions.previous_page_number }}{% if notes.number != 1 %}&np={{ notes.number }}{% endif %}" class="button">&laquo; Prev</a>
  {% endif %}
  <span class="pagination-info">Page {{ versions.number }} of {{ versions.paginator.num_pages }}</span>
  {% if versions.has_next %}
  <a href="?vp={{ versions.next_page_number }}{% if notes.number != 1 %}&np={{ notes.number }}{% endif %}" class="button">Next &raquo;</a>
  {% endif %}
</div>
{% endif %}
{% else %}
<p class="empty-message">No versions yet.</p>
{% endif %}

{% if is_owner %}
<section class="lineup-section">
  <div class="section-header">
    <h2>Lineup Notes</h2>
  </div>

  <form method="post" action="{% url 'lineups-note-add' lineup.code %}" class="note-form">
    {% csrf_token %}
    {{ note_form.text }}
    <button type="submit" class="button button-primary">Add Note</button>
  </form>

  <div id="notes-list">
    {% for note in notes %}
    {% include 'lineups/partials/note-item.html' %}
    {% empty %}
    <p class="empty-message">No notes yet.</p>
    {% endfor %}
  </div>

  {% if notes.paginator.num_pages > 1 %}
  <div class="pagination">
    {% if notes.has_previous %}
    <a href="?np={{ notes.previous_page_number }}{% if versions.number != 1 %}&vp={{ versions.number }}{% endif %}" class="button">&laquo; Prev</a>
    {% endif %}
    <span class="pagination-info">Page {{ notes.number }} of {{ notes.paginator.num_pages }}</span>
    {% if notes.has_next %}
    <a href="?np={{ notes.next_page_number }}{% if versions.number != 1 %}&vp={{ versions.number }}{% endif %}" class="button">Next &raquo;</a>
    {% endif %}
  </div>
  {% endif %}
</section>
{% endif %}
{% endblock %}
